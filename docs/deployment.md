# ðŸš€ Deployment Guide - Battery Department Customer Portal

## Render.com Deployment (Recommended)

### Step 1: Repository Setup
1. Push your code to GitHub/GitLab
2. Connect repository to Render.com
3. Select "Web Service" type

### Step 2: Build Configuration
- **Environment**: Node
- **Build Command**: `./build.sh`
- **Start Command**: `npm start`
- **Auto-Deploy**: Yes

### Step 3: Environment Variables
Configure these environment variables in Render dashboard:

#### Required Variables
- `NODE_ENV=production`
- `NEXTAUTH_URL` (auto-generated by Render)
- `NEXTAUTH_SECRET` (generate a secure random string)
- `DATABASE_URL` (from Render PostgreSQL service)
- `STRIPE_SECRET_KEY`
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`

#### Optional Variables
- `STRIPE_WEBHOOK_SECRET`
- `SMTP_HOST`
- `SMTP_USER`
- `SMTP_PASSWORD`
- `NEXT_PUBLIC_GA_ID`

### Step 4: Database Setup
1. Create PostgreSQL database service on Render
2. Run database migrations:
   ```bash
   npx prisma migrate deploy
   ```

### Step 5: Stripe Webhook Configuration
1. In Stripe Dashboard, go to Webhooks
2. Add endpoint: `https://your-render-url.com/api/webhooks/stripe`
3. Select events: `payment_intent.succeeded`, `payment_intent.payment_failed`
4. Copy webhook secret to environment variables

## Alternative Deployment Options

### Vercel
```bash
npm install -g vercel
vercel deploy
```

### Netlify
```bash
npm run build
# Upload .next folder to Netlify
```

### Docker
```bash
docker build -t battery-portal .
docker run -p 3000:3000 battery-portal
```

## Environment-Specific Configurations

### Development
```env
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### Staging
```env
NODE_ENV=staging
NEXT_PUBLIC_APP_URL=https://staging.batterydepartment.com
```

### Production
```env
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://batterydepartment.com
```

## Performance Optimization

### Bundle Analysis
```bash
npm run analyze
```

### Caching Strategy
- Static assets: 1 year cache
- API responses: Appropriate cache headers
- Database queries: Connection pooling

## Monitoring & Analytics

### Health Checks
Endpoint: `/api/health`
Returns: Service status and dependencies

### Performance Monitoring
- Core Web Vitals tracking
- API response times
- Database query performance

## Security Checklist

- [ ] HTTPS enabled
- [ ] Environment variables secured
- [ ] Database access restricted
- [ ] API rate limiting configured
- [ ] CORS properly configured
- [ ] Security headers implemented

## Troubleshooting

### Common Issues

1. **Build Failures**
   - Check Node.js version (18+)
   - Verify all dependencies installed
   - Check TypeScript errors

2. **Database Connection**
   - Verify DATABASE_URL format
   - Check network connectivity
   - Confirm database migrations

3. **Stripe Integration**
   - Verify API keys
   - Check webhook configuration
   - Test in Stripe test mode first

### Debug Commands
```bash
# Check build locally
npm run build

# Verify environment variables
printenv | grep NEXT_

# Test database connection
npx prisma studio
```
